"use strict";const shell=require("shelljs"),logging=require("debug")("Weaver:bin:commands:add:client"),{getConfig,setConfig}=require("../../lib/config"),{generateId}=require("../../lib/utils"),defaultMsg=`Usage
  weaver add client -f mongo -t source -n my_source_db -u mongodb://localhost:27017
`,clientExists=a=>{const b={...getConfig()},{dataClients:c}=b;return c.some(b=>b.family===a.family&&b.type===a.type&&b.db.name===a.name)},addClient=(a={})=>{const{family:b,type:c,name:d,url:e}=a,f=generateId({length:8}),g={...getConfig()},{dataClients:h}=g;return clientExists(a)?(shell.echo("Client exists, skipping"),g):(logging(`Saving new settings ${g}`),h.push({clientId:f,family:b,type:c,db:{url:e,name:d,options:{}}}),setConfig(g),shell.echo("Saved new settings:",JSON.stringify(g,null,2)),g)},commandSpec=a=>(shell.echo(defaultMsg),a.option("family",{alias:"f"}).option("type",{alias:"t"}).option("name",{alias:"n"}).option("url",{alias:"u"}).demandOption("family").demandOption("type").demandOption("name").demandOption("url")),commandHandler=a=>(logging("client params",a),addClient(a),a);module.exports={commandName:"client",commandDesc:"Interactive creation of a new client",commandSpec,commandHandler};