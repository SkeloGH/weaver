"use strict";const shell=require("shelljs"),logging=require("debug")("Weaver:bin:commands:add:client"),{getConfig,setConfig}=require("../../lib/config"),{generateId}=require("../../lib/utils"),defaultMsg=`Usage
  weaver add client -f mongo -t [source|client] -o [<source.name>] -n my_source_db -u mongodb://localhost:27017
`,isSameFamily=(a,b)=>a.family===b.family,isSameType=(a,b)=>a.type===b.type,isSameName=(a,b)=>a.db.name===b.name,clientExists=a=>{const b={...getConfig()},{dataClients:c}=b,d={exists:!0};return d.exists=c.some(b=>{const c=isSameFamily(b,a),e=isSameName(b,a),f=isSameType(b,a),g=c&&e&&f,h=c&&e&&!f;return g&&(d.message="Error: client exists"),h&&(d.message="Error: source and target clients are the same"),g||h}),d},addClient=(a={})=>{const{family:b,origin:c,type:d,name:e,url:f}=a,g=generateId({length:8}),h={...getConfig()},{dataClients:i}=h,j=clientExists(a);return j.exists?(shell.echo(j.message),h):(logging(`Saving new settings ${h}`),i.push({clientId:g,family:b,type:d,origin:c,db:{url:f,name:e,options:{}}}),setConfig(h),shell.echo("Saved new settings:",JSON.stringify(h,null,2)),h)},commandSpec=a=>(shell.echo(defaultMsg),a.option("family",{alias:"f"}).option("type",{alias:"t"}).option("origin",{alias:"o"}).option("name",{alias:"n"}).option("url",{alias:"u"}).demandOption("family").demandOption("type").demandOption("name").demandOption("url")),commandHandler=a=>(logging("client params",a),addClient(a),a);module.exports={commandName:"client",commandDesc:"Interactive creation of a new client",commandSpec,commandHandler};